<header>
    <a href="/">home</a>
    <span class="material-symbols-outlined">chevron_right</span>
    <span class="posts-label"></span>

</header>
<img class="posts-header-img" src="{{root_url}}/public/img/free_keyboard.jpg" alt="{{ site.title }}" />
<div class="posts-header-background"></div>
<div class="posts-header-title"></div>

<div class="posts-container">
    <div class="row"></div>
</div>

<script id="collection" type="application/json">
    {
    {% for collection in site.collections %}
    "{{ collection.label | escape }}": {
    "name": {% if collection.name %}"{{ collection.name | escape }}"{% else %}"{{ collection.label | escape }}"{% endif %},
    "img": "{{ collection.img | escape }}",
    "docs":[
    {% for doc in collection.docs %}
    {"title": "{{ doc.title | escape }}", "url": "{{ doc.url | relative_url | escape }}"
    }
    {% unless forloop.last %}, {% endunless %}
    {% endfor %}
    ]
    }
    {% unless forloop.last %}, {% endunless %}
    {% endfor %}
    }
</script>

<script>
    function escapeQuotesInHTMLTags(jsonString) { // HTML 태그 내의 큰따옴표를 이스케이프 처리
        return jsonString.replace(/<[^>]*>/g, function(match) {
            return match.replace(/"/g, '\\"');
        });
    }
    let jsonString = $('#collection').text()
    jsonString = escapeQuotesInHTMLTags(jsonString);
    jsonString = JSON.parse(jsonString)

    const label = window.location.hash.substring(1);
    const data = jsonString[label]

    $('.posts-header-title').html(`${data['name']}`)
    $('.posts-label').html(`${data['name']}`)
    $('.posts-header-img').attr('src', `{{root_url}}/public/img/${data['img']}`)
    console.log(data['img'])
    // $('.collection-emoji').html(`${data['emoji']} &nbsp; ${data['name']}`)

    function clickPost(url) {
        window.location.href = url
    }

    const html = data['docs'].map(doc => {
        return `<div class="col-lg-4 col-md-6 col-12 posts-outer-item">
                    <div onclick="clickPost('${doc.url}')" class="posts-inner-item">
                        <div class="posts-doc-img">이미지가 들어갈 곳</div>
                        <div class="posts-doc-title">${doc.title}</div>
                    </div>
                </div>`
    }).join('');
    $('.posts-container .row').append(html)


</script>

<link rel="stylesheet" href="{{root_url}}/public/css/post.css">
<link rel="stylesheet" href="{{root_url}}/public/css/dynamic-tag.css">
<div class="fixed-post-list">
    {% assign dir = page.url | url_decode | split: '/' | slice: -2, 1 | first %}
    <div title="{{dir}} 다른 글" class="post-list-btn"><span class="material-symbols-outlined">category</span></div>
    <div class="post-list d-none">
        <div class="post-list-title">{{ dir }}의 다른 글 <i class="fa-solid fa-xmark"></i></div>
        <div class="post-list-content">
            {% assign documents = site['docs'][dir] %}
            {% assign sorted_docs = documents | sort: "created_date" | reverse %}
            {% for doc in sorted_docs %}
            {% if doc.url == page.url %}
            <a href="{{doc.url}}" class="page">{{doc.title}}</a>
            {% else %}
            <a href="{{doc.url}}">{{doc.title}}</a>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<img class="post-header-img" src="{{root_url}}/public/img/{{page.img}}" onerror="this.onerror=null; this.src='{{root_url}}/public/img/default.jpg';" />
<div class="post-header-background"></div>
<div class="post-header-date"><span class="material-symbols-outlined">edit_calendar</span>{{page.created_date | date: "%Y.%m.%d"}}</div>
<div class="post-header-title">{{page.title}}</div>
<div class="post-container">
    <div class="post-content">{{content}}</div>
</div>
<indexnav>
    <navicon title="목차 네비"><i class="fa-solid fa-list"></i></navicon>
    <navlist class="d-none">
        <navmenu><i class="fa-solid fa-ellipsis"></i><i class="fa-solid fa-xmark"></i></navmenu>
        <navitem></navitem>
    </navlist>
</indexnav>

<!-- 다른 게시글 보기 버튼 이벤트 -->
<script>
    $(document).ready(function () {
        $('.post-list-btn').on('click', function() {
            $('.post-list').removeClass('d-none');
            $('.post-list-btn').addClass('d-none');
        })
        $('.post-list-title .fa-xmark').on('click', function() {
            $('.post-list').addClass('d-none');
            $('.post-list-btn').removeClass('d-none');
        })
    })
</script>

<!-- 코드 블럭 복사 이벤트 -->
<script>
    $(document).ready(function () {
        const $highlightDiv = $('div.highlight');
        const $button = $('<span class="copy-button"><i class="fa-regular fa-copy"></i> Copy</span>');
        $(document).on('click', '.copy-button', function() { // 이벤트 위임
            const div = $(this).closest('div.highlight');
            const index = div.index('div.highlight');

            const codeText = div.find('code').text();
            navigator.clipboard.writeText(codeText).then(function() {
                $('.copy-button').eq(index).html('<i class="fa-regular fa-copy"></i> Copied');
            }).catch(function(err) {
                console.error('텍스트 복사에 실패했습니다: ', err);
            });
        });

        $highlightDiv.append($button)
    })
</script>

<!-- post 내 이미지 src 변경 -->
<script>
    $(document).ready(function () {
        const url = "{{site.url}}"
        const pathname = decodeURIComponent(location.pathname);
        const dir = pathname.split('/').slice(-3, -2)[0]
        $('.post-content img').each(function() {
            const filename = $(this).attr('src')
            $(this).attr('src', `${url}/public/img/${dir}/${filename}`)
        })
    })
</script>

<!-- 사용자 정의 태그 소괄호는 js/custom/latex-with-parentheses-tag.js 에 정의 -->
<script>
    $(document).ready(function () {
        // 전체
        let html = $('.post-content').html()

        // @@ <desc></desc>
        html = html.replace(/@@(.+?)(\r\n|[\s]*\r|\n|$)/g, "<desc>$1</desc>$2");

        // ++ <plus></plus>
        html = html.replace(/\+\+(.+?)(\r\n|[\s]*\r|\n|$)/g, "<plus>$1</plus>$2");

        $(".post-content").html(html);
    })
</script>

<!-- 우측 게시글 nav -->
<script src="{{root_url}}/public/js/custom/post-side-nav.js"></script>

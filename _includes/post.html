<div class="post-side-menu"></div>

<img class="post-header-img" src="{{root_url}}/public/img/{{page.img}}" alt="{{ site.title }}" />
<div class="post-header-background"></div>
<div class="post-header-title">{{page.title}}</div>
<div class="post-container">
    <div class="post-side"></div>
    <div class="post-content">{{content}}</div>
    <div class="post-side">
        <div class="post-side-fixed">
            <div class="post-side-column-direction-scroll">
                <div class="post-nav"></div>
            </div>
        </div>
    </div>
</div>

<script id="collection" type="application/json">
    {
    {% for collection in site.collections %}
    "{{ collection.label | escape }}": {
    "name": {% if collection.name %}"{{ collection.name | escape }}"{% else %}"{{ collection.label | escape }}"{% endif %},
    "img": "{{ collection.img | escape }}",
    "docs":[
    {% for doc in collection.docs %}
    {"title": "{{ doc.title | escape }}", "url": "{{ doc.url | relative_url | escape }}"
    }
    {% unless forloop.last %}, {% endunless %}
    {% endfor %}
    ]
    }
    {% unless forloop.last %}, {% endunless %}
    {% endfor %}
    }
</script>

<!-- post 좌측 사이드 메뉴  -->
<script>
    function escapeQuotesInHTMLTags(jsonString) { // HTML 태그 내의 큰따옴표를 이스케이프 처리
        return jsonString.replace(/<[^>]*>/g, function(match) {
            return match.replace(/"/g, '\\"');
        });
    }

    const path = window.location.pathname
    const label = path.split('/')[1]

    let jsonString = $('#collection').text()
    jsonString = escapeQuotesInHTMLTags(jsonString);
    jsonString = JSON.parse(jsonString)
    const data = jsonString[label]

    // header.html
    $('.header-path').html(`
        <span class="material-symbols-outlined">chevron_right</span>
        <a href="/posts/#${label}" class="post-label">${data['name']}</a>
        <span class="material-symbols-outlined">chevron_right</span>
        {{page.title}}
    `)

    if (label === 'project') { // project 라벨인 경우
        $('.header-path').html(`
        <span class="material-symbols-outlined">chevron_right</span>
        {{page.title}}
        `)
    }

    $('.header-side-menu-btn-group').html(`
        <i class="post-side-menu-open-btn fa-solid fa-bars"></i>
        <span class="post-side-menu-hide-btn material-symbols-outlined">keyboard_double_arrow_left</span>
    `)

    $('.post-side-menu-open-btn').on('click', function () {
        $('.post-side-menu').addClass('post-side-menu-show')
        $('header').addClass('post-header-move')
        $('.post-side-menu-open-btn').css('display', 'none')
        $('.post-side-menu-hide-btn').css('display', 'inline-block')
    })
    $('.post-side-menu-hide-btn').on('click', function () {
        $('.post-side-menu').removeClass('post-side-menu-show')
        $('header').removeClass('post-header-move')
        $('.post-side-menu-open-btn').css('display', 'inline-block')
        $('.post-side-menu-hide-btn').css('display', 'none')
    })

    const html = data['docs'].map(doc => {
        return `
            <a class="post-menu-title" href='${doc.url}'>${doc.title}</a>
        `
    }).join('');
    $('.post-side-menu').append(html)

</script>

<!-- 우측 게시글 nav -->
<script>
        $(document).ready(function () {
            $('h3, h4, h5').each(function (index) {
                let headerId = `header-${index}`
                $(this).attr('id', 'header-' + index);

                let indentCount = this.tagName.replace('H', '') - 2
                let navItem = $('<div></div>').addClass('post-nav-item').addClass(`post-nav-item-${indentCount}`).html($(this).text()).attr('title', $(this).text())

                navItem.on('click', function(e) {
                    $('html, body').animate({
                        scrollTop: $(`#${headerId}`).offset().top - $('.fixed-header').outerHeight()
                    }, 500)
                })
                $('.post-side-fixed').css('display', 'block')
                $('.post-nav').append(navItem)
            });
        });
</script>

<!-- () 안 font 설정 -->
<script>
    $(document).ready(function () {
        $('li').each(function() {
            const updatedText = $(this).text().replace(/\(([^)]+)\)/g, '(<span class="parentheses">$1</span>)');
            $(this).html(updatedText)
        })
    })
</script>